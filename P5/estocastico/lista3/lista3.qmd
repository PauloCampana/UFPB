---
format: pdf
lang: pt
title: Atividade 3
subtitle: Cadeias de Markov
author: Paulo Ricardo Seganfredo Campana
date: 2023-08-10
date-format: long
callout-icon: false
highlight-style: github
---

::: hidden
\pagestyle{empty}
\thispagestyle{empty}
\newcommand{\p}[2][]{\mathrm{P}{#1} \kern-2pt \left( #2 \right)}
\newcommand{\pc}[2]{\mathrm{P} \kern-2pt \left( #1 \; \big\rvert \; #2 \right)}
\newcommand{\E}[1]{\mathrm{E} \kern-2pt \left[ #1 \right]}
:::

::: {.callout-note}
# 1) Implemente um script para simular uma cadeia de Markov com base no seguinte algoritmo:

```{r}
simular <- function(n, transição, inicial) {
    stopifnot(
        n == as.integer(n), n >= 0,
        nrow(transição) == ncol(transição),
        all(rowSums(transição) == 1), sum(inicial) == 1
    )
    X0 <- sample(names(inicial), size = 1, prob = inicial)
    X <- X0
    if(n == 0) return(X) 
    for(i in 1:n) {
        j <- X[i]
        p <- transição[j, ]
        X[i + 1] <- sample(names(p), size = 1, prob = p)
    }
    X |> as.numeric()
}
expm <- function(x, n) {
    stopifnot(
        n == as.integer(n), n >= 1,
        ncol(x) == nrow(x)
    )
    list(x) |> 
        replicate(n = n) |> 
        Reduce(f = "%*%")
}
```
:::

{{< pagebreak >}}

::: {.callout-note}
# 2) *Ruina do jogador:* Suponha que o jogador inicia com 4 reais e que ele aposta até ganhar 10 reais ou ficar na ruina. Em cada jogada, ele ganha 1 real com probabilidade 0.4 e perde 1 real com probabilidade 0.6. Determine o ganho esperado do jogador após 5 jogadas.

$$
\E{X_5} = 
\sum_{x \in \mathcal S} x \pi_5(x) = 
\pmb{\pi}_5^\top \mathbf{x} =
\pmb{\pi}_0^\top \mathbf{P}^5 \mathbf{x}  =
3.02592
$$

```{r}
#| echo: false
pi0 <- rep(0, 11)
pi0[5] <- 1
names(pi0) <- 0:10

P <- matrix(0, 11, 11)
for (i in 1:11) {
    if(i %in% c(1, 11)) P[i,i] <- 1
    else {
        P[i,i - 1] <- 0.6
        P[i,i + 1] <- 0.4
    }
}
colnames(P) <- 0:10
rownames(P) <- 0:10

x <- 0:10
```

|    $\mathbf x^\top$|  0|  1|  2|  3|  4|  5|  6|  7|  8|  9| 10|
|-------------------:|--:|--:|--:|--:|--:|--:|--:|--:|--:|--:|--:|
|$\pmb{\pi}_0^{\top}$|  0|  0|  0|  0|  1|  0|  0|  0|  0|  0|  0|

|$\mathbf P$|0   |1   |2   |3   |4   |5   |6   |7   |8   |9   |10  |
|----------:|:---|:---|:---|:---|:---|:---|:---|:---|:---|:---|:---|
|          0|1   |0   |0   |0   |0   |0   |0   |0   |0   |0   |0   |
|          1|0.6 |0   |0.4 |0   |0   |0   |0   |0   |0   |0   |0   |
|          2|0   |0.6 |0   |0.4 |0   |0   |0   |0   |0   |0   |0   |
|          3|0   |0   |0.6 |0   |0.4 |0   |0   |0   |0   |0   |0   |
|          4|0   |0   |0   |0.6 |0   |0.4 |0   |0   |0   |0   |0   |
|          5|0   |0   |0   |0   |0.6 |0   |0.4 |0   |0   |0   |0   |
|          6|0   |0   |0   |0   |0   |0.6 |0   |0.4 |0   |0   |0   |
|          7|0   |0   |0   |0   |0   |0   |0.6 |0   |0.4 |0   |0   |
|          8|0   |0   |0   |0   |0   |0   |0   |0.6 |0   |0.4 |0   |
|          9|0   |0   |0   |0   |0   |0   |0   |0   |0.6 |0   |0.4 |
|         10|0   |0   |0   |0   |0   |0   |0   |0   |0   |0   |1   |

```{r}
#| output: false
t(pi0) %*% expm(P, 5) %*% x
```
```{r}
#| echo: false
as.numeric(t(pi0) %*% expm(P, 5) %*% x)
```
:::

{{< pagebreak >}}

::: {.callout-note}
# 3) Suponha que Maria tem cinco músicas favoritas, enumeradas em ordem de preferência (1, 2, 3, 4, 5), e que em um dia qualquer ela seleciona uma dessas cinco músicas para ouvir o dia inteiro. Assuma que em um dia particular ela escolhe uma das músicas 1, 2, 3, 4, 5 com probabilidades 0.35, 0.3, 0.2, 0.1, 0.05, respectivamente, e que a escolha para o dia seguinte seja dada pela matriz de transição. Supondo que as possíveis seleções em dias posteriores possam ser modeladas por uma cadeia de Markov, ache a probabilidade de Maria ouvir a música nº 2 no terceiro e quinto dia, e a música nº 4 no oitavo dia.

$$
\p{X_3 = 2, X_5 = 2, X_8 = 4} =
$$
$$
\sum_{x \in \mathcal S} \pi_0(x) \p[^3]{x,2} \p[^2]{2,2} \p[^3]{2,4} = 0.01633164
$$

```{r}
#| echo: false
pi0 <- c(0.35, 0.3, 0.2, 0.1, 0.05)
names(pi0) <- 1:5

P <- rbind(
    c(0  , 0.5, 0.3, 0.1, 0.1),
    c(0.4, 0  , 0.3, 0.2, 0.1),
    c(0.3, 0.3, 0  , 0.2, 0.2),
    c(0.4, 0.3, 0.2, 0  , 0.1),
    c(0.3, 0.3, 0.2, 0.2, 0  )
)
colnames(P) <- 1:5
rownames(P) <- 1:5
```

|       $x$|    1|   2|   3|   4|    5|
|---------:|----:|---:|---:|---:|----:|
|$\pi_0(x)$| 0.35| 0.3| 0.2| 0.1| 0.05|

|$\mathbf P$|   1|   2|   3|   4|   5|
|----------:|---:|---:|---:|---:|---:|
|          1|   0| 0.5| 0.3| 0.1| 0.1|
|          2| 0.4|   0| 0.3| 0.2| 0.1|
|          3| 0.3| 0.3|   0| 0.2| 0.2|
|          4| 0.4| 0.3| 0.2|   0| 0.1|
|          5| 0.3| 0.3| 0.2| 0.2|   0|

```{r}
P2 <- expm(P, 2)
P3 <- expm(P, 3)

sum(sapply(
    1:5,
    \(x) pi0[x] * P3[x,2] * P2[2,2] * P3[2,4] 
))
```
:::

{{< pagebreak >}}

::: {.callout-note}
# 4) Considere uma cadeia de Markov com matriz de transição \newline a) Obtenha o grafo de transição (grafo ponderado dirigido) da cadeia. \newline b) O grafo de transição da cadeia pode ser obtido sem arestas dirigidas (grafo ponderado). Mostre tal grafo.

```{r}
#| echo: false
P <- rbind(
    c(0  , 3/5, 1/5, 1/5),
    c(3/4, 0  , 1/4, 0  ),
    c(1/4, 1/4, 1/4, 1/4),
    c(1/4, 0  , 1/4, 1/2)
)
colnames(P) <- letters[1:4]
rownames(P) <- letters[1:4]
```

|$\mathbf P$|    a|    b|    c|    d|
|----------:|----:|----:|----:|----:|
|          a|    0|  0.6|  0.2|  0.2|
|          b| 0.75|    0| 0.25|    0|
|          c| 0.25| 0.25| 0.25| 0.25|
|          d| 0.25|    0| 0.25|  0.5|

```{r}
#| echo: false
#| warning: false
#| fig-height: 5.6
library(diagram)
plotmat(
    t(P),
    curve = 0.025,
    relsize = 0.85,
    box.col = "#f0f5fd",
    shadow.size = 0,
    self.lwd = 2,
    self.cex = 0.75,
    self.shiftx = -0.1,
    self.shifty = 0.1,
    self.arrpos = 2
)
```
:::

{{< pagebreak >}}

::: {.callout-warning}
#
Pela propriedade

$$
\p[^n]{x,y} = \sum_{m=1}^n \p[_x]{T_y = m} \p[^{n-m}]{y,y}
$$

Tomando apenas o ultimo termo $m$ = $n$:

$$
\p[^n]{x,y} \geqslant 
\p[_x]{T_y = n} \p[^0]{y,y} =
\p[_x]{T_y = n}
$$

$$
\p[^n]{x,y} \geqslant \p[_x]{T_y = n}
$$
:::

::: {.callout-note}
# 5) Mostre que $\p[^n]{x,y} > 0$ para algum inteiro positivo $n$ se, e somente se, $\rho_{xy} > 0$.

Começando por $\rho_{xy} > 0$

$$
\p[_x]{T_y < \infty} > 0 
$$
$$
\p[_x]{\bigcup_{n=1}^{\infty} T_y = n} > 0
$$

Para pelo menos um $n$, a probabilidade $\p[_x]{T_y = n}$ é maior que 0.

$$
\p[^n]{x,y} \geqslant \p[_x]{T_y = n} > 0
$$
$$
\p[^n]{x,y} > 0
$$

Começando por $\p[^n]{x,y} > 0$

$$
\sum_{m=1}^n \p[_x]{T_y = m} \p[^{n-m}]{y,y} > 0
$$

Para pelo menos um $m$, esse produto $\p[_x]{T_y = m} \p[^{n-m}]{y,y}$ é maior que 0.

$$
\p[_x]{T_y = m} \p[^{n-m}]{y,y} > 0
$$
$$
\p[_x]{T_y = m} > 0
$$
$$
\p[_x]{T_y < \infty} > 0
$$
$$
\rho_{xy} > 0
$$
:::